{"ast":null,"code":"import axios from 'axios';\nimport Cookie from 'js-cookie';\nimport { MessageBox, Message } from 'element-ui';\nimport store from '@/store'; // import { getToken } from '@/utils/auth'\n\naxios.defaults.headers['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8'; // 创建axios实例\n\nconst service = axios.create({\n  // axios中请求配置有baseURL选项，表示请求URL公共部分\n  baseURL: process.env.VUE_APP_BASE_SERVER,\n  // aa:1,\n  // 超时\n  timeout: 10000\n}); // request拦截器\n\nservice.interceptors.request.use(config => {\n  config._t = Date.parse(new Date()) / 1000;\n\n  if (config.method == 'get') {\n    config.url = config.url + '?' + Date.parse(new Date()) / 1000;\n  }\n\n  if (config.selfTime) {\n    config.timeout = config.selfTime;\n  }\n\n  config.headers['Authorization'] = Cookie.get('token');\n  return config;\n}, error => {\n  console.log(error);\n  Promise.reject(error);\n}); // 响应拦截器\n\nservice.interceptors.response.use(res => {\n  const code = res.data.code;\n\n  if (res.headers['token']) {\n    // sessionStorage.setItem('token', res.headers['token'])\n    Cookie.set('token', res.headers['token']);\n  }\n\n  if (code == 200) {\n    return res.data;\n  } else {\n    if (code === 120700 || code === 120701) {\n      // sessionStorage.removeItem('token');\n      var keys = document.cookie.match(/[^ =;]+(?==)/g);\n\n      if (keys) {\n        for (var i = keys.length; i--;) {\n          document.cookie = keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString(); // 清除一级域名下的或指定的，例如 .ratingdog.cn\n        }\n      }\n\n      window.location.href = '/#/';\n      return;\n    }\n\n    if (code === 401) {\n      MessageBox.confirm('登录状态已过期，您可以继续留在该页面，或者重新登录', '系统提示', {\n        confirmButtonText: '重新登录',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        store.dispatch('LogOut').then(() => {\n          location.reload(); // 为了重新实例化vue-router对象 避免bug\n        });\n      });\n    } else {\n      // Message(res.data.message)\n      return res.data;\n    }\n  }\n}, error => {\n  console.log('err' + error);\n\n  if (error.message != sessionStorage.getItem('errorMessage')) {\n    Message({\n      message: error.message,\n      type: 'error',\n      duration: 5 * 1000,\n      onClose: function () {\n        sessionStorage.removeItem('errorMessage');\n      }\n    });\n    sessionStorage.setItem('errorMessage', error.message);\n  } else {}\n\n  return Promise.reject(error);\n});\nexport default service;","map":{"version":3,"names":["axios","Cookie","MessageBox","Message","store","defaults","headers","service","create","baseURL","process","env","VUE_APP_BASE_SERVER","timeout","interceptors","request","use","config","_t","Date","parse","method","url","selfTime","get","error","console","log","Promise","reject","response","res","code","data","set","keys","document","cookie","match","i","length","toUTCString","window","location","href","confirm","confirmButtonText","cancelButtonText","type","then","dispatch","reload","message","sessionStorage","getItem","duration","onClose","removeItem","setItem"],"sources":["/Users/kexiao/workroom/1-work/quedong/src/utils/service.js"],"sourcesContent":["import axios from 'axios'\r\nimport Cookie from 'js-cookie'\r\nimport { MessageBox, Message } from 'element-ui'\r\nimport store from '@/store'\r\n\r\n// import { getToken } from '@/utils/auth'\r\naxios.defaults.headers['Content-Type'] =\r\n  'application/x-www-form-urlencoded;charset=utf-8'\r\n// 创建axios实例\r\nconst service = axios.create({\r\n  // axios中请求配置有baseURL选项，表示请求URL公共部分\r\n  baseURL: process.env.VUE_APP_BASE_SERVER,\r\n  // aa:1,\r\n  // 超时\r\n  timeout: 10000,\r\n})\r\n// request拦截器\r\nservice.interceptors.request.use(\r\n  (config) => {\r\n    config._t = Date.parse(new Date()) / 1000\r\n    if (config.method == 'get') {\r\n      config.url = config.url + '?' + Date.parse(new Date()) / 1000\r\n    }\r\n    if (config.selfTime) {\r\n      config.timeout = config.selfTime\r\n    }\r\n    config.headers['Authorization'] = Cookie.get('token')\r\n    return config\r\n  },\r\n  (error) => {\r\n    console.log(error)\r\n    Promise.reject(error)\r\n  }\r\n)\r\n// 响应拦截器\r\nservice.interceptors.response.use(\r\n  (res) => {\r\n    const code = res.data.code\r\n    if (res.headers['token']) {\r\n      // sessionStorage.setItem('token', res.headers['token'])\r\n      Cookie.set('token', res.headers['token'])\r\n    }\r\n    if (code == 200) {\r\n      return res.data\r\n    } else {\r\n      if (code === 120700 || code === 120701) {\r\n        // sessionStorage.removeItem('token');\r\n        var keys = document.cookie.match(/[^ =;]+(?==)/g)\r\n        if (keys) {\r\n          for (var i = keys.length; i--; ) {\r\n            document.cookie =\r\n              keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString() // 清除一级域名下的或指定的，例如 .ratingdog.cn\r\n          }\r\n        }\r\n        window.location.href = '/#/'\r\n        return\r\n      }\r\n      if (code === 401) {\r\n        MessageBox.confirm(\r\n          '登录状态已过期，您可以继续留在该页面，或者重新登录',\r\n          '系统提示',\r\n          {\r\n            confirmButtonText: '重新登录',\r\n            cancelButtonText: '取消',\r\n            type: 'warning',\r\n          }\r\n        ).then(() => {\r\n          store.dispatch('LogOut').then(() => {\r\n            location.reload() // 为了重新实例化vue-router对象 避免bug\r\n          })\r\n        })\r\n      } else {\r\n        // Message(res.data.message)\r\n        return res.data\r\n      }\r\n    }\r\n  },\r\n  (error) => {\r\n    console.log('err' + error)\r\n    if (error.message != sessionStorage.getItem('errorMessage')) {\r\n      Message({\r\n        message: error.message,\r\n        type: 'error',\r\n        duration: 5 * 1000,\r\n        onClose: function () {\r\n          sessionStorage.removeItem('errorMessage')\r\n        },\r\n      })\r\n      sessionStorage.setItem('errorMessage', error.message)\r\n    } else {\r\n    }\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\nexport default service\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}